<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Timer with Qualtrics Intercept</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #survey-iframe { 
            width: 100%; 
            height: 500px; 
            border: 1px solid #ccc; 
        }
        #timer-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #f0f0f0;
            padding: 20px;
            border: 2px solid #333;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 9999999999999999999;
            display: none;
            width: 300px;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000000002;
            display: none;
        }
    </style>
</head>

<body>
    <h1>Main Website</h1>
    <p>This page contains a survey in an iframe and a timer popup that may interrupt.</p>
    
    <iframe id="survey-iframe" src="https://zn9bwreamgwdwatnf-wellsfargocxsandbox.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_9BwReAmgWdWatNf" title="Survey Form"></iframe>
    
    <div class="overlay" id="overlay"></div>
    <div id="timer-popup">
        <h2>Important Notice!</h2>
        <p>Your session is about to expire. Would you like to extend your session?</p>
        <button id="continue-survey">Continue Survey</button>
    </div>
    
    <button id="trigger-popup">Simulate Timed Popup</button>

    <script>
        const overlay = document.getElementById('overlay');
        const popup = document.getElementById('timer-popup');
        const continueBtn = document.getElementById('continue-survey');
        
        let timer;
        const SESSION_TIME = 15000; // 1 minute
        let popupOpen = false;

        function startSessionTimer() {
            timer = setTimeout(showPopup, SESSION_TIME);
        }

        function showPopup() {
            if (!popupOpen) {
                popupOpen = true;
                overlay.style.display = 'block';
                popup.style.display = 'block';
                
                // Focus on the Continue Survey button
                continueBtn.focus();
            }
        }

        function resetTimer() {
            clearTimeout(timer);
            startSessionTimer(); // Restart the session timer
        }

        function closePopup() {
            overlay.style.display = 'none';
            popup.style.display = 'none';
            popupOpen = false;
        }

        function extendSession() {
            // Unload the Qualtrics intercept
            if (typeof QSI !== 'undefined' && QSI.API) {
                QSI.API.unload(); // Unload current intercept
                QSI.API.load(); // Reload the intercept
            }
            closePopup();
            resetTimer(); // Reset the timer when extending session
        }

        // Event listeners for buttons
        continueBtn.addEventListener('click', extendSession);
        document.getElementById('trigger-popup').addEventListener('click', showPopup);

        // Start the session timer when the page loads
        window.onload = function() {
            startSessionTimer();
        };
    </script>

    <!-- Qualtrics Website Feedback Snippet -->
    <script type='text/javascript'>
        (function(){
            var g=function(g){
                this.go=function(){
                    var a=document.createElement("script");
                    a.type="text/javascript";
                    a.src=g; 
                    document.body&&document.body.appendChild(a)
                };
                this.start=function(){
                    var t=this;
                    "complete"!==document.readyState?
                    window.addEventListener?window.addEventListener("load",function(){t.go()},!1):
                    window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()
                };
            };
            try{
                // Qualtrics intercept script with your Q_ZID placeholder
                (new g("https://zn9bwreamgwdwatnf-wellsfargocxsandbox.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_9BwReAmgWdWatNf")).start();
            } catch(i){
                console.error("Qualtrics intercept loading error: ", i);
            }
        })();
//ADA focus changes code test
        (function() { 
    
    // Change this selector to match the intercept iframe on your page 
    const iframeSelector = '.QSIWebResponsiveDialog-Layout1-SI_8Jna9K5PTcSmf3w_content.QSIWebResponsiveDialog-Layout1-SI_8Jna9K5PTcSmf3w_content-medium.QSIWebResponsiveDialog-Layout1-SI_8Jna9K5PTcSmf3w_border-radius-slightly-rounded.QSIWebResponsiveDialog-Layout1-SI_8Jna9K5PTcSmf3w_drop-shadow-light';
    const iframe = document.querySelector(iframeSelector); if (!iframe) return;

const modified = new Map(); 

function isVisible(el) { try { return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length); } catch (e) { return false; } }

function saveAndHideTopLevelSiblings() { if (isHidden) return; previousActiveElement = document.activeElement;


const bodyChildren = Array.from(document.body.children);
bodyChildren.forEach(child => {
  // skip the iframe element itself and any ancestor that contains the iframe
  if (child === iframe || child.contains(iframe)) return;

  if (!modified.has(child)) {
    modified.set(child, {
      ariaHidden: child.getAttribute('aria-hidden'),
      inert: 'inert' in child ? child.inert : undefined,
      focusables: []
    });
  }

  // set aria-hidden
  child.setAttribute('aria-hidden', 'true');

  // try inert first
  if ('inert' in child) {
    child.inert = true;
  } else {
    // fallback: make focusable descendants unfocusable
    const focusableSelector = 'a, button, input, textarea, select, [tabindex]';
    const focusables = Array.from(child.querySelectorAll(focusableSelector));
    focusables.forEach(node => {
      // store prior tabindex
      const prevTab = node.getAttribute('tabindex');
      modified.get(child).focusables.push({ node, prevTab });
      try {
        node.setAttribute('tabindex', '-1');
      } catch (e) {}
    });
  }
});

// Focus the iframe element itself. If same-origin and accessible, try to focus an element inside after load.
try {
  iframe.focus();
} catch (e) {
  // ignore
}

isHidden = true;
}

function restoreTopLevelSiblings() { if (!isHidden) return; 
    modified.forEach((data, el) => {
    //restore aria-hidden 
    if (data.ariaHidden === null) el.removeAttribute('aria-hidden'); else el.setAttribute('aria-hidden', data.ariaHidden);


  // restore inert
  if (typeof data.inert !== 'undefined' && 'inert' in el) {
    el.inert = data.inert;
  }

  // restore tabindex on focusable descendants if we changed them
  if (data.focusables && data.focusables.length) {
    data.focusables.forEach(item => {
      if (item.prevTab === null) item.node.removeAttribute('tabindex');
      else item.node.setAttribute('tabindex', item.prevTab);
    });
  }
});
modified.clear();

// restore focus
try {
  if (previousActiveElement && typeof previousActiveElement.focus === 'function') {
    previousActiveElement.focus();
  }
} catch (e) {}
isHidden = false;
}

// Observe attributes (style/class) and childList of the iframe's parent or the iframe itself 
// // We need to detect when the iframe becomes visible/hidden, or is removed from DOM.  const parent = iframe.parentElement || document.body; 

const obs = new MutationObserver(mutations => { 
    // If iframe is removed from the DOM, restore and disconnect 
    if (!document.body.contains(iframe)) { restoreTopLevelSiblings(); obs.disconnect(); return; }


// Check visibility heuristics
const visible = isVisible(iframe);
if (visible) saveAndHideTopLevelSiblings();
else restoreTopLevelSiblings();

// Also check for attribute changes that might make the iframe visible (style/class)
for (const m of mutations) {
  if (m.type === 'attributes' && (m.attributeName === 'style' || m.attributeName === 'class')) {
    const nowVisible = isVisible(iframe);
    if (nowVisible) saveAndHideTopLevelSiblings();
    else restoreTopLevelSiblings();
  }
}
});

// Clean up on unload 
window.addEventListener('unload', () => {restoreTopLevelSiblings(); }); })();
        
    </script>
    <div id='ZN_9BwReAmgWdWatNf'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
</body>

</html>
